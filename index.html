<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BETA SMART FINANCE PRO v2.0 - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…Ø±Ù† Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap');
        * { 
            font-family: 'Cairo', sans-serif;
            box-sizing: border-box;
        }
        body { 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            min-height: 100vh;
        }
        
        @media print {
            body { 
                print-color-adjust: exact; 
                -webkit-print-color-adjust: exact; 
                margin: 0;
                padding: 0;
                background: white !important;
            }
            .print-hidden { display: none !important; }
            .print-only { display: block !important; }
            .print-container { 
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 20mm !important;
                background: white !important;
            }
            @page {
                size: A4;
                margin: 15mm;
            }
            .glass-card {
                background: white !important;
                border: 1px solid #ccc !important;
            }
        }
        
        .print-only { display: none; }
        
        /* Modern Glassmorphism Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-dark {
            background: rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        /* Premium Gradient Backgrounds - BETA Corporate Colors */
        .gradient-primary {
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        }
        
        .gradient-info {
            background: linear-gradient(135deg, #DC143C 0%, #A52A2A 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #DC143C 0%, #FF6347 100%);
        }
        
        .gradient-dark {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }
        
        /* Modern Input Styles */
        .modern-input {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .modern-input:focus {
            border-color: #DC143C;
            box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.15);
            transform: translateY(-2px);
        }
        
        .modern-input:hover {
            border-color: #FF6B6B;
        }
        
        /* Premium Button Styles */
        .btn-premium {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-premium::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-premium:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* Modern Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-pro {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .badge-new {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
            border-radius: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slide-in { animation: slideIn 0.4s ease-out; }

        .comparison-table td, .comparison-table th {
            padding: 12px;
            border: 1px solid #e5e7eb;
        }
        
        .comparison-highlight-positive {
            background-color: #d1fae5;
            font-weight: bold;
        }
        
        .comparison-highlight-negative {
            background-color: #fee2e2;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BETA SMART FINANCE ENGINE - FLEXIBLE PAYMENT SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        class SmartPaymentEngine {
            constructor(unitValue, cashDiscountRate, discountRate, baseDate = new Date()) {
                this.unitValue = unitValue;
                this.cashDiscountRate = cashDiscountRate / 100;
                this.discountRate = discountRate / 100;
                this.cashValue = unitValue * (1 - this.cashDiscountRate);
                this.baseDate = new Date(baseDate);
                this.baseDate.setHours(0, 0, 0, 0);
            }

            // â•â•â• XNPV IMPLEMENTATION â•â•â•
            calculateXNPV(rate, cashFlows) {
                if (cashFlows.length === 0) return 0;
                
                return cashFlows.reduce((npv, cf) => {
                    const cfDate = new Date(cf.date);
                    cfDate.setHours(0, 0, 0, 0);
                    
                    const days = Math.round((cfDate - this.baseDate) / (1000 * 60 * 60 * 24));
                    const years = days / 365;
                    
                    if (days <= 0) {
                        return npv + cf.amount;
                    }
                    
                    return npv + cf.amount / Math.pow(1 + rate, years);
                }, 0);
            }

            calculatePVWithDate(amount, paymentDate) {
                const payment = new Date(paymentDate);
                payment.setHours(0, 0, 0, 0);
                const days = Math.round((payment - this.baseDate) / (1000 * 60 * 60 * 24));
                const years = days / 365;
                
                if (days <= 0) {
                    return amount;
                }
                
                return amount / Math.pow(1 + this.discountRate, years);
            }

            addMonths(date, months) {
                const d = new Date(date);
                d.setMonth(d.getMonth() + months);
                return d;
            }

            // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø£Ø´Ù‡Ø± Ù…Ø¹ Ø¶Ø¨Ø· Ø§Ù„ÙŠÙˆÙ… Ø¹Ù„Ù‰ 1 Ø£Ùˆ 15 Ø¨Ø´ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚
            addMonthsWithDay(date, months, day) {
                const d = new Date(date);
                // Ù†Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                let newMonth = d.getMonth() + months;
                let newYear = d.getFullYear();
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø£Ø´Ù‡Ø±
                while (newMonth > 11) {
                    newMonth -= 12;
                    newYear++;
                }
                while (newMonth < 0) {
                    newMonth += 12;
                    newYear--;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ ØªØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ù‡Ø± Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ timezone
                const result = new Date(newYear, newMonth, day, 12, 0, 0);
                
                return result;
            }
            
            // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ timezone)
            formatDateLocal(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // â•â•â• FIND EQUAL INSTALLMENT â•â•â•
            findEqualInstallmentXNPV(targetPV, dates) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        calculatedPV += this.calculatePVWithDate(mid, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // â•â•â• EQUAL INSTALLMENTS â•â•â•
            calculateEqualInstallments(params) {
                const {
                    downPayment,
                    downPaymentDate,
                    numberOfYears,
                    frequency = 4,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyPayments = [],
                    quarterlyStartDate = null,
                    installmentDay = 1 // ÙŠÙˆÙ… Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø· (1 Ø£Ùˆ 15)
                } = params;
                
                const basePaymentDate = downPaymentDate || this.baseDate;
                
                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'Ù…Ù‚Ø¯Ù…',
                    date: this.formatDateLocal(basePaymentDate),
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©
                annualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(basePaymentDate, (index + 1) * 12, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©
                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(basePaymentDate, (index + 1) * 6, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© (Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©)
                quarterlyPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(basePaymentDate, (index + 1) * 3, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø§Ù„Ø´Ù‡ÙˆØ±
                const monthsInterval = 12 / frequency; // âœ… Ø§Ù„ØªØµØ­ÙŠØ­
                
                // ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ø¹ Ø¶Ø¨Ø· Ø§Ù„ÙŠÙˆÙ… Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±
                let startDate;
                if (quarterlyStartDate) {
                    // Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯Ø§Ù‹ØŒ Ù†Ø£Ø®Ø° Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© ÙÙ‚Ø· ÙˆÙ†Ø¶Ø¨Ø· Ø§Ù„ÙŠÙˆÙ…
                    const tempDate = new Date(quarterlyStartDate);
                    // Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ù‡Ø± Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ timezone
                    startDate = new Date(tempDate.getFullYear(), tempDate.getMonth(), installmentDay, 12, 0, 0);
                } else {
                    // ÙŠØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø¯Ø¯
                    startDate = this.addMonthsWithDay(basePaymentDate, monthsInterval, installmentDay); // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±
                }
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonthsWithDay(startDate, i * (12 / frequency), installmentDay));
                }

                const installmentAmount = this.findEqualInstallmentXNPV(remainingPV, quarterlyDates);

                quarterlyDates.forEach((date, index) => {
                    const pv = this.calculatePVWithDate(installmentAmount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `Ù‚Ø³Ø· Ù…ÙˆØ­Ø¯ ${index + 1}`,
                        date: this.formatDateLocal(date),
                        amount: installmentAmount,
                        pv,
                        discount: installmentAmount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'equal',
                    patternName: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…ÙˆØ­Ø¯',
                    downPayment,
                    installmentAmount,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    quarterlyPayments: quarterlyPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            // â•â•â• DECREASING PAYMENTS â•â•â•
            calculateDecreasingPayments(params) {
                const {
                    downPayment,
                    numberOfYears,
                    frequency = 4,
                    decreaseRate = 2,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyPayments = [],
                    quarterlyStartDate = null,
                    installmentDay = 1
                } = params;

                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'Ù…Ù‚Ø¯Ù…',
                    date: this.formatDateLocal(this.baseDate),
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                annualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 12, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 6, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© (Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©)
                quarterlyPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 3, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø§Ù„Ø´Ù‡ÙˆØ±
                const monthsInterval = 12 / frequency; // âœ… Ø§Ù„ØªØµØ­ÙŠØ­

                let startDate;
                if (quarterlyStartDate) {
                    const tempDate = new Date(quarterlyStartDate);
                    startDate = new Date(tempDate.getFullYear(), tempDate.getMonth(), installmentDay, 12, 0, 0);
                } else {
                    startDate = this.addMonthsWithDay(this.baseDate, monthsInterval, installmentDay); // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±
                }
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonthsWithDay(startDate, i * (12 / frequency), installmentDay));
                }

                const baseInstallment = this.findBaseInstallmentDecreasing(remainingPV, quarterlyDates, decreaseRate / 100);

                quarterlyDates.forEach((date, index) => {
                    const amount = baseInstallment * Math.pow(1 - decreaseRate / 100, index);
                    const pv = this.calculatePVWithDate(amount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `Ù‚Ø³Ø· Ù…ØªÙ†Ø§Ù‚Øµ ${index + 1}`,
                        date: this.formatDateLocal(date),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'decreasing',
                    patternName: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªÙ†Ø§Ù‚ØµØ©',
                    downPayment,
                    baseInstallment,
                    decreaseRate,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    quarterlyPayments: quarterlyPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            findBaseInstallmentDecreasing(targetPV, dates, decreaseRate) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        const amount = mid * Math.pow(1 - decreaseRate, i);
                        calculatedPV += this.calculatePVWithDate(amount, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // â•â•â• GRADUATED PAYMENTS â•â•â•
            calculateGraduatedPayments(params) {
                const {
                    downPayment,
                    numberOfYears,
                    frequency = 4,
                    growthRate = 3,
                    annualPayments = [],
                    semiannualPayments = [],
                    quarterlyPayments = [],
                    quarterlyStartDate = null,
                    installmentDay = 1
                } = params;

                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'Ù…Ù‚Ø¯Ù…',
                    date: this.formatDateLocal(this.baseDate),
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                annualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 12, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                semiannualPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 6, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© (Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©)
                quarterlyPayments.forEach((payment, index) => {
                    const paymentDate = payment.date ? new Date(new Date(payment.date).setHours(12, 0, 0)) : this.addMonthsWithDay(this.baseDate, (index + 1) * 3, installmentDay);
                    const amount = payment.amount;
                    
                    const pv = this.calculatePVWithDate(amount, paymentDate);
                    knownPV += pv;
                    
                    schedule.push({
                        id: paymentId++,
                        type: payment.type || `Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© ${index + 1}`,
                        date: this.formatDateLocal(paymentDate),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const remainingPV = this.cashValue - knownPV;
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø§Ù„Ø´Ù‡ÙˆØ±
                const monthsInterval = 12 / frequency; // âœ… Ø§Ù„ØªØµØ­ÙŠØ­

                let startDate;
                if (quarterlyStartDate) {
                    const tempDate = new Date(quarterlyStartDate);
                    startDate = new Date(tempDate.getFullYear(), tempDate.getMonth(), installmentDay, 12, 0, 0);
                } else {
                    startDate = this.addMonthsWithDay(this.baseDate, monthsInterval, installmentDay); // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±
                }
                
                const numberOfQuarters = numberOfYears * frequency;
                const quarterlyDates = [];
                for (let i = 0; i < numberOfQuarters; i++) {
                    quarterlyDates.push(this.addMonthsWithDay(startDate, i * (12 / frequency), installmentDay));
                }

                const baseInstallment = this.findBaseInstallmentGraduated(remainingPV, quarterlyDates, growthRate / 100);

                quarterlyDates.forEach((date, index) => {
                    const amount = baseInstallment * Math.pow(1 + growthRate / 100, index);
                    const pv = this.calculatePVWithDate(amount, date);
                    schedule.push({
                        id: paymentId++,
                        type: `Ù‚Ø³Ø· Ù…ØªØ²Ø§ÙŠØ¯ ${index + 1}`,
                        date: this.formatDateLocal(date),
                        amount,
                        pv,
                        discount: amount - pv
                    });
                });

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'graduated',
                    patternName: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ²Ø§ÙŠØ¯Ø©',
                    downPayment,
                    baseInstallment,
                    growthRate,
                    numberOfInstallments: quarterlyDates.length,
                    annualPayments: annualPayments.length,
                    semiannualPayments: semiannualPayments.length,
                    quarterlyPayments: quarterlyPayments.length,
                    frequency,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            findBaseInstallmentGraduated(targetPV, dates, growthRate) {
                let low = 0, high = targetPV * 2, tolerance = 0.1;
                const maxIterations = 100;
                let iterations = 0;

                while (high - low > tolerance && iterations < maxIterations) {
                    const mid = (low + high) / 2;
                    
                    let calculatedPV = 0;
                    for (let i = 0; i < dates.length; i++) {
                        const amount = mid * Math.pow(1 + growthRate, i);
                        calculatedPV += this.calculatePVWithDate(amount, dates[i]);
                    }
                    
                    if (calculatedPV < targetPV) {
                        low = mid;
                    } else {
                        high = mid;
                    }
                    
                    iterations++;
                }
                
                return (low + high) / 2;
            }

            // â•â•â• CUSTOM DISTRIBUTION â•â•â•
            calculateCustomDistribution(params) {
                const {
                    downPayment,
                    customPayments = [],
                    quarterlyYears = 0,
                    quarterlyStartDate = null,
                    installmentDay = 1
                } = params;
                
                let knownPV = downPayment;
                const schedule = [{
                    id: 0,
                    type: 'Ù…Ù‚Ø¯Ù…',
                    date: this.formatDateLocal(this.baseDate),
                    amount: downPayment,
                    pv: downPayment,
                    discount: 0
                }];

                let paymentId = 1;

                customPayments.forEach((payment) => {
                    const baseAmount = payment.amount;

                    if (payment.frequency === 'once') {
                        const paymentDate = payment.startDate ? new Date(payment.startDate) : new Date();
                        const pv = this.calculatePVWithDate(baseAmount, paymentDate);
                        knownPV += pv;
                        
                        schedule.push({
                            id: paymentId++,
                            type: payment.type || 'Ø¯ÙØ¹Ø©',
                            date: this.formatDateLocal(paymentDate),
                            amount: baseAmount,
                            pv,
                            discount: baseAmount - pv
                        });
                    } else {
                        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                        let monthsInterval;
                        switch (payment.frequency) {
                            case 'annual':
                                monthsInterval = 12;
                                break;
                            case 'semiannual':
                                monthsInterval = 6;
                                break;
                            case 'quarterly':
                                monthsInterval = 3;
                                break;
                            default:
                                monthsInterval = 12;
                        }
                        
                        const numberOfPayments = payment.numberOfPayments || 1;
                        const startDate = payment.startDate ? new Date(payment.startDate) : new Date();
                        
                        for (let i = 0; i < numberOfPayments; i++) {
                            const paymentDate = this.addMonthsWithDay(startDate, i * monthsInterval, installmentDay);
                            const pv = this.calculatePVWithDate(baseAmount, paymentDate);
                            knownPV += pv;
                            
                            schedule.push({
                                id: paymentId++,
                                type: `${payment.type || 'Ø¯ÙØ¹Ø©'} ${i + 1}`,
                                date: this.formatDateLocal(paymentDate),
                                amount: baseAmount,
                                pv,
                                discount: baseAmount - pv
                            });
                        }
                    }
                });

                if (quarterlyYears > 0) {
                    const remainingPV = this.cashValue - knownPV;
                    let startDate;
                    if (quarterlyStartDate) {
                        const tempDate = new Date(quarterlyStartDate);
                        startDate = new Date(tempDate.getFullYear(), tempDate.getMonth(), installmentDay, 12, 0, 0);
                    } else {
                        // Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ÙØªØ±Ø© Ø¹Ù„Ù‰ 3 Ø£Ø´Ù‡Ø± Ù„Ù€ "Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©"
                        startDate = this.addMonthsWithDay(this.baseDate, 3, installmentDay); 
                    }
                    
                    const numberOfQuarters = quarterlyYears * 4;
                    const quarterlyDates = [];
                    for (let i = 0; i < numberOfQuarters; i++) {
                        quarterlyDates.push(this.addMonthsWithDay(startDate, i * 3, installmentDay));
                    }

                    const quarterlyInstallment = this.findEqualInstallmentXNPV(remainingPV, quarterlyDates);

                    quarterlyDates.forEach((date, index) => {
                        const pv = this.calculatePVWithDate(quarterlyInstallment, date);
                        schedule.push({
                            id: paymentId++,
                            type: `Ù‚Ø³Ø· Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ ${index + 1}`,
                            date: this.formatDateLocal(date),
                            amount: quarterlyInstallment,
                            pv,
                            discount: quarterlyInstallment - pv
                        });
                    });
                }

                const verification = this.verifyScheduleXNPV(schedule);

                return {
                    pattern: 'custom',
                    patternName: 'Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®ØµØµ',
                    downPayment,
                    customPayments,
                    schedule,
                    verification,
                    summary: this.calculateSummary(schedule)
                };
            }

            // â•â•â• BASE SYSTEM â•â•â•
            calculateBaseSystem(baseSystemConfig, unitValue) {
                if (!baseSystemConfig) return null;

                const downPaymentDate = baseSystemConfig.downPaymentDate 
                    ? new Date(baseSystemConfig.downPaymentDate) 
                    : this.baseDate;

                const downPayment = baseSystemConfig.downPaymentIsPercentage 
                    ? unitValue * (baseSystemConfig.downPaymentValue / 100)
                    : baseSystemConfig.downPaymentValue;

                const annualPayments = (baseSystemConfig.annualPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                const semiannualPayments = (baseSystemConfig.semiannualPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                const quarterlyPayments = (baseSystemConfig.quarterlyPayments || []).map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date ? new Date(p.date) : null
                }));

                return this.calculateEqualInstallments({
                    downPayment,
                    downPaymentDate,
                    numberOfYears: baseSystemConfig.quarterlyYears,
                    frequency: 4,
                    annualPayments,
                    semiannualPayments,
                    quarterlyPayments,
                    quarterlyStartDate: null
                });
            }

            // â•â•â• IMPLIED DISCOUNT RATE â•â•â•
            calculateImpliedDiscountRate(baseSystem, unitValue) {
                const targetPV = this.cashValue;
                const payments = [];
                
                const downPaymentDate = baseSystem.downPaymentDate 
                    ? new Date(baseSystem.downPaymentDate) 
                    : this.baseDate;
                
                const downPayment = baseSystem.downPaymentIsPercentage 
                    ? unitValue * (baseSystem.downPaymentValue / 100)
                    : baseSystem.downPaymentValue;
                    
                payments.push({ amount: downPayment, date: downPaymentDate });
                
                // Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©
                if (baseSystem.annualPayments && baseSystem.annualPayments.length > 0) {
                    baseSystem.annualPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 12);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }

                // Ø§Ù„Ø¯ÙØ¹Ø§Øª Ù†ØµÙ Ø§Ù„Ø³Ù†ÙˆÙŠØ©
                if (baseSystem.semiannualPayments && baseSystem.semiannualPayments.length > 0) {
                    baseSystem.semiannualPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 6);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }

                // Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                if (baseSystem.quarterlyPayments && baseSystem.quarterlyPayments.length > 0) {
                    baseSystem.quarterlyPayments.forEach((payment, index) => {
                        const date = payment.date 
                            ? new Date(payment.date) 
                            : this.addMonths(downPaymentDate, (index + 1) * 3);
                        const amount = payment.isPercentage 
                            ? unitValue * (payment.value / 100)
                            : payment.value;
                        payments.push({ amount, date });
                    });
                }
                
                let knownAmount = payments.reduce((sum, p) => sum + p.amount, 0);
                let remainingAmount = unitValue - knownAmount;
                
                const numberOfQuarters = baseSystem.quarterlyYears * 4;
                const quarterlyAmount = remainingAmount / numberOfQuarters;
                
                for (let i = 0; i < numberOfQuarters; i++) {
                    const date = this.addMonths(downPaymentDate, (i + 1) * 3);
                    payments.push({ amount: quarterlyAmount, date });
                }
                
                return this.findDiscountRateXNPV(payments, targetPV);
            }

            findDiscountRateXNPV(payments, targetPV, tolerance = 0.00001) {
                let lowRate = 0.00;
                let highRate = 0.50;
                let iterations = 0;
                const maxIterations = 100;
                
                const cashFlows = payments.map(p => ({
                    date: p.date,
                    amount: p.amount
                }));

                while (highRate - lowRate > tolerance && iterations < maxIterations) {
                    const midRate = (lowRate + highRate) / 2;
                    
                    const calculatedPV = this.calculateXNPV(midRate, cashFlows);
                    
                    if (calculatedPV < targetPV) {
                        highRate = midRate;
                    } else {
                        lowRate = midRate;
                    }
                    
                    iterations++;
                }
                
                const finalRate = (lowRate + highRate) / 2;
                return finalRate * 100;
            }

            // â•â•â• VERIFICATION â•â•â•
            verifyScheduleXNPV(schedule) {
                const cashFlows = schedule.map(p => ({
                    date: new Date(p.date),
                    amount: p.amount
                }));

                const totalPV = this.calculateXNPV(this.discountRate, cashFlows);
                const totalPaid = schedule.reduce((sum, payment) => sum + payment.amount, 0);
                const difference = totalPV - this.cashValue;
                const percentDiff = (difference / this.cashValue) * 100;
                
                return {
                    totalPV,
                    totalPaid,
                    cashValue: this.cashValue,
                    difference,
                    percentDiff,
                    status: Math.abs(difference) < 1000 ? 'Ù…Ø·Ø§Ø¨Ù‚ âœ…' : 'ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ âŒ',
                    accuracy: Math.abs(percentDiff) < 0.1 ? 'Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©' : 'ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„'
                };
            }

            calculateSummary(schedule) {
                const totalPaid = schedule.reduce((sum, p) => sum + p.amount, 0);
                const totalPV = schedule.reduce((sum, p) => sum + p.pv, 0);
                const totalDiscount = schedule.reduce((sum, p) => sum + p.discount, 0);
                
                return {
                    numberOfPayments: schedule.length,
                    totalPaid,
                    totalPV,
                    totalDiscount,
                    effectiveInterestRate: ((totalPaid - this.cashValue) / this.cashValue) * 100,
                    averagePayment: totalPaid / schedule.length
                };
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BETA SMART FINANCE - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…Ø±Ù†
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function BetaSmartFinance() {
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const ADMIN_PASSWORD = 'beta2025';

            const [projects, setProjects] = useState(() => {
                const saved = localStorage.getItem('betaProjects_v2_9');
                return saved ? JSON.parse(saved) : [
                   
                    { 
                        id: 1, 
                        name: 'Ø¨ÙŠØªØ§ Ø±ÙŠØ²ÙŠØ¯Ù†Ø³ Ø£ÙƒØªÙˆØ¨Ø±', 
                        cashDiscountRate: 30, 
                        discountRate: 14.00,
                        discountRateMode: 'manual',
                        minDownPaymentPercent: 5,
                        maxInstallmentYears: 8,
                        baseSystem: {
                            downPaymentValue: 15,
                            downPaymentIsPercentage: true,
                            downPaymentDate: null,
                            annualPayments: [{ value: 10, isPercentage: true, type: 'Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ©', date: null }],
                            semiannualPayments: [],
                            quarterlyPayments: [],
                            quarterlyYears: 8
                        },
                        description: 'Ù…Ø¬Ù…Ø¹ Ø³ÙƒÙ†ÙŠ ÙØ§Ø®Ø±', 
                        color: 'purple' 
                    },
                    { 
                        id: 2, 
                        name: 'Ø¨ÙŠØªØ§ Ø¬Ø±ÙŠÙ†Ø² - Ù…Ø³ØªÙ‚Ø¨Ù„ Ø³ÙŠØªÙ‰', 
                        cashDiscountRate: 2.583, 
                        discountRate: 24.000,
                        discountRateMode: 'manual',
                        minDownPaymentPercent: 50,
                        maxInstallmentYears: 4,
                        baseSystem: {
                            downPaymentValue: 50,
                            downPaymentIsPercentage: true,
                            downPaymentDate: null,
                            annualPayments: [],
                            semiannualPayments: [],
                            quarterlyPayments: [],
                            quarterlyYears: 0.25
                        },
                        description: 'ğŸ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±Ù‰: 50% Ù…Ù‚Ø¯Ù… Ùˆ50% Ø¨Ø¹Ø¯ 3 Ø´Ù‡ÙˆØ± | Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙ…ÙŠØ² ÙÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„ Ø³ÙŠØªÙ‰', 
                        color: 'green' 
                    },
                    { 
                        id: 3, 
                        name: 'Ø¹Ø±Ø¶ Ø¨ÙŠØªØ§ Ø¬Ø±ÙŠÙ†Ø² - Ù…Ø³ØªÙ‚Ø¨Ù„ Ø³ÙŠØªÙ‰', 
                        cashDiscountRate: 8, 
                        discountRate: 17.210,
                        discountRateMode: 'manual',
                        minDownPaymentPercent: 50,
                        maxInstallmentYears: 4,
                        baseSystem: {
                            downPaymentValue: 50,
                            downPaymentIsPercentage: true,
                            downPaymentDate: null,
                            annualPayments: [],
                            semiannualPayments: [],
                            quarterlyPayments: [],
                            quarterlyYears: 2
                        },
                        description: 'ğŸ¯ Ø¹Ø±Ø¶ Ø®Ø§Øµ: 50% Ù…Ù‚Ø¯Ù… ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø³Ù†ØªÙŠÙ† | Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙ…ÙŠØ² ÙÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„ Ø³ÙŠØªÙ‰', 
                        color: 'blue' 
                    }
                ];
            });
            
            useEffect(() => {
                localStorage.setItem('betaProjects_v2_9', JSON.stringify(projects));
            }, [projects]);

            const [showProjectsManager, setShowProjectsManager] = useState(false);
            const [editingProject, setEditingProject] = useState(null);
            const [selectedProjectId, setSelectedProjectId] = useState(1);
            const [showBaseSystemModal, setShowBaseSystemModal] = useState(false);
            const [currentProjectForBaseSystem, setCurrentProjectForBaseSystem] = useState(null);
            const [tempBaseSystem, setTempBaseSystem] = useState({
                downPaymentValue: 10,
                downPaymentIsPercentage: true,
                annualPayments: [],
                semiannualPayments: [],
                quarterlyPayments: [],
                quarterlyYears: 8,
                startDate: ''
            });

            const [unitValue, setUnitValue] = useState(1000000);
            const [unitNumber, setUnitNumber] = useState('');
            const [selectedPattern, setSelectedPattern] = useState('equal');
            const [results, setResults] = useState(null);
            const [baseSystemResults, setBaseSystemResults] = useState(null);
            const [showComparison, setShowComparison] = useState(false);

            // Installment Details
            const [downPaymentValue, setDownPaymentValue] = useState(20);
            const [downPaymentIsPercentage, setDownPaymentIsPercentage] = useState(true);
            const [numberOfYears, setNumberOfYears] = useState(8);
            const [frequency, setFrequency] = useState(4); // 4 = quarterly, 2 = semiannual, 1 = annual, 12 = monthly
            const [decreaseRate, setDecreaseRate] = useState(2);
            const [growthRate, setGrowthRate] = useState(3);
            const [quarterlyStartDate, setQuarterlyStartDate] = useState('');
            const [installmentDay, setInstallmentDay] = useState(1); // 1 or 15
            const [roundingOption, setRoundingOption] = useState('100'); // 'none', '100', '500', '1000'

            // Additional Payments
            const [annualPayments, setAnnualPayments] = useState([]);
            const [semiannualPayments, setSemiannualPayments] = useState([]);
            const [quarterlyPayments, setQuarterlyPayments] = useState([]);
            
            // Custom Distribution
            const [customPayments, setCustomPayments] = useState([]);
            const [customQuarterlyYears, setCustomQuarterlyYears] = useState(0);
            const [customQuarterlyStartDate, setCustomQuarterlyStartDate] = useState('');

            const getSelectedProject = () => projects.find(p => p.id === selectedProjectId);

            const patterns = [
                { id: 'equal', name: 'Ù‚Ø³Ø· Ù…ÙˆØ­Ø¯', description: 'Ù‚Ø³Ø· Ø«Ø§Ø¨Øª Ø·ÙˆØ§Ù„ Ø§Ù„Ù…Ø¯Ø©', color: 'blue', icon: 'ğŸ’°' },
                { id: 'decreasing', name: 'Ù‚Ø³Ø· Ù…ØªÙ†Ø§Ù‚Øµ', description: 'Ù‚Ø³Ø· ÙŠØªÙ†Ø§Ù‚Øµ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª', color: 'red', icon: 'ğŸ“‰' },
                { id: 'graduated', name: 'Ù‚Ø³Ø· Ù…ØªØ²Ø§ÙŠØ¯', description: 'Ù‚Ø³Ø· ÙŠØªØ²Ø§ÙŠØ¯ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª', color: 'purple', icon: 'ğŸ“ˆ' },
                { id: 'custom', name: 'ØªÙˆØ²ÙŠØ¹ Ù…Ø®ØµØµ', description: 'Ø£Ù†Øª ØªØ­Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª', color: 'amber', icon: 'âš¡' },
            ];

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('ar-EG', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value) + ' Ø¬';
            };

            const formatDate = (dateString) => {
                return new Date(dateString).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
            };

            // Ø¯Ø§Ù„Ø© ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚Ø³Ø· Ù„Ù„Ø£Ø¹Ù„Ù‰ (Ù„Ø£Ù‚Ø±Ø¨ ØµÙØ±ÙŠÙ† = 100)
            const roundInstallmentUp = (amount, roundTo = 100) => {
                return Math.ceil(amount / roundTo) * roundTo;
            };
            
            // Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª (Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø£Ù‚Ø±Ø¨ 100)
            const applyAutoRoundingToSchedule = (schedule) => {
                return schedule.map(payment => {
                    // Ù„Ø§ Ù†Ù‚Ø±Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ø§Ù„Ø³Ù†ÙˆÙŠØ©/Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©/Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©)
                    if (payment.type === 'Ù…Ù‚Ø¯Ù…' || payment.type.includes('Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ©') || payment.type.includes('Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©') || payment.type.includes('Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©')) {
                        return payment;
                    }
                    // ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø£Ù‚Ø±Ø¨ 100
                    const roundedAmount = roundInstallmentUp(payment.amount, 100);
                    return { ...payment, amount: roundedAmount, discount: roundedAmount - payment.pv };
                });
            };

            // Ø¯Ø§Ù„Ø© ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚Ø³Ø· (Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©)
            const roundInstallment = (amount, option) => {
                if (option === 'none' || !option) return amount;
                const roundTo = parseInt(option);
                // Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹
                return Math.ceil(amount / roundTo) * roundTo;
            };

            // Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª (Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©)
            const applyRoundingToSchedule = (schedule, roundingOpt) => {
                if (roundingOpt === 'none' || !roundingOpt) return schedule;

                return schedule.map(payment => {
                    // Ù„Ø§ Ù†Ù‚Ø±Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    if (payment.type === 'Ù…Ù‚Ø¯Ù…' || payment.type.includes('Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ©') || payment.type.includes('Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©') || payment.type.includes('Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©')) {
                        return payment;
                    }

                    const roundedAmount = roundInstallment(payment.amount, roundingOpt);
                    return { ...payment, amount: roundedAmount, discount: roundedAmount - payment.pv };
                });
            };

            const handlePrint = () => {
                const element = document.getElementById('print-area');
                if (!element) return;

                const opt = {
                    margin: 10,
                    filename: `${getSelectedProject()?.name || 'Ø®Ø·Ø©_Ø³Ø¯Ø§Ø¯'}_${unitNumber || 'ÙˆØ­Ø¯Ø©'}_${results?.patternName || ''}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                };

                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø±
                const loadingMsg = document.createElement('div');
                loadingMsg.id = 'pdf-loading';
                loadingMsg.innerHTML = '<div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;"><div style="background:white;padding:30px;border-radius:10px;text-align:center;"><p style="font-size:18px;margin:0;">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF...</p><p style="font-size:14px;color:#666;margin-top:10px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p></div></div>';
                document.body.appendChild(loadingMsg);

                html2pdf().set(opt).from(element).save().then(() => {
                    document.body.removeChild(loadingMsg);
                }).catch((err) => {
                    document.body.removeChild(loadingMsg);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ PDF');
                    console.error(err);
                });
            };

            const calculateDownPayment = () => {
                return downPaymentIsPercentage ? unitValue * (downPaymentValue / 100) : downPaymentValue;
            };

            useEffect(() => {
                const project = getSelectedProject();
                if (project && project.baseSystem && unitValue > 0) {
                    if (selectedPattern === 'equal' || selectedPattern === 'decreasing' || selectedPattern === 'graduated') {
                        setDownPaymentValue(project.baseSystem.downPaymentValue);
                        setDownPaymentIsPercentage(project.baseSystem.downPaymentIsPercentage);
                        setNumberOfYears(project.baseSystem.quarterlyYears);
                        setFrequency(4); // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‡Ùˆ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

                        // Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                        setAnnualPayments((project.baseSystem.annualPayments || []).map((p, index) => ({
                            id: index + 1,
                            type: p.type,
                            value: p.value,
                            isPercentage: p.isPercentage,
                            date: p.date ? new Date(p.date).toISOString().split('T')[0] : ''
                        })));
                        setSemiannualPayments((project.baseSystem.semiannualPayments || []).map((p, index) => ({
                            id: index + 1,
                            type: p.type,
                            value: p.value,
                            isPercentage: p.isPercentage,
                            date: p.date ? new Date(p.date).toISOString().split('T')[0] : ''
                        })));
                        setQuarterlyPayments((project.baseSystem.quarterlyPayments || []).map((p, index) => ({
                            id: index + 1,
                            type: p.type,
                            value: p.value,
                            isPercentage: p.isPercentage,
                            date: p.date ? new Date(p.date).toISOString().split('T')[0] : ''
                        })));
                        
                    } else if (selectedPattern === 'custom') {
                        // ØªØµÙÙŠØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙ„ Ù„Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®ØµØµ
                        setDownPaymentValue(20);
                        setDownPaymentIsPercentage(true);
                        setCustomPayments([]);
                        setCustomQuarterlyYears(0);
                        setCustomQuarterlyStartDate('');
                        setAnnualPayments([]);
                        setSemiannualPayments([]);
                        setQuarterlyPayments([]);
                    }
                }
                setResults(null);
                setBaseSystemResults(null);
                setShowComparison(false);
            }, [selectedProjectId, unitValue, selectedPattern]);

            const handleAdminLogin = () => {
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    setShowAdminPanel(false);
                    alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±');
                } else {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            };

            const calculateBaseSystemImpliedRate = () => {
                const project = getSelectedProject();
                if (!project || !unitValue || unitValue <= 0) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹.');
                    return;
                }
                if (!tempBaseSystem.downPaymentValue) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.');
                    return;
                }
                if (!tempBaseSystem.quarterlyYears) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.');
                    return;
                }

                const engine = new SmartPaymentEngine(
                    unitValue, 
                    project.cashDiscountRate, 
                    0.0, // Ù…Ø¹Ø¯Ù„ Ø®ØµÙ… Ù…Ø¤Ù‚Øª Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ XNPV
                    new Date() 
                );

                const impliedRate = engine.calculateImpliedDiscountRate(tempBaseSystem, unitValue);

                const updatedProjects = projects.map(p => {
                    if (p.id === currentProjectForBaseSystem.id) {
                        return { ...p, 
                            discountRate: impliedRate, 
                            discountRateMode: 'auto', 
                            baseSystem: tempBaseSystem 
                        };
                    }
                    return p;
                });
                setProjects(updatedProjects);
                setShowBaseSystemModal(false);
                alert(`âœ… ØªÙ… Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø®ØµÙ… Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ "${currentProjectForBaseSystem.name}"!\n\nÙ…Ø¹Ø¯Ù„ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…Ø­Ø³ÙˆØ¨: ${impliedRate.toFixed(3)}%\n\nØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.`);
            };

            const addProject = () => {
                const newProject = {
                    id: Date.now(),
                    name: 'Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯',
                    cashDiscountRate: 30,
                    discountRate: 14.643,
                    discountRateMode: 'manual',
                    minDownPaymentPercent: 5,
                    maxInstallmentYears: 8, // â† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    baseSystem: {
                        downPaymentValue: 15,
                        downPaymentIsPercentage: true,
                        annualPayments: [],
                        semiannualPayments: [],
                        quarterlyPayments: [],
                        quarterlyYears: 8,
                        downPaymentDate: null
                    },
                    description: 'ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                    color: 'indigo'
                };
                setProjects([...projects, newProject]);
                setEditingProject(newProject.id);
            };

            const deleteProject = (projectId) => {
                if (projects.length === 1) {
                    alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¢Ø®Ø± Ù…Ø´Ø±ÙˆØ¹!');
                    return;
                }
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ')) {
                    setProjects(projects.filter(p => p.id !== projectId));
                    if (selectedProjectId === projectId) {
                        setSelectedProjectId(projects.find(p => p.id !== projectId).id);
                    }
                }
            };

            const updateProject = (projectId, field, value) => {
                setProjects(projects.map(p => p.id === projectId ? { ...p, [field]: value } : p ));
            };

            const addAnnualPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setFullYear(today.getFullYear() + annualPayments.length + 1);
                setAnnualPayments([...annualPayments, { id: Date.now(), type: `Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ© ${annualPayments.length + 1}`, value: 100000, isPercentage: false, date: defaultDate.toISOString().split('T')[0] }]);
            };
            const updateAnnualPayment = (id, field, value) => {
                setAnnualPayments(annualPayments.map(p => p.id === id ? { ...p, [field]: value } : p ));
            };
            const deleteAnnualPayment = (id) => {
                setAnnualPayments(annualPayments.filter(p => p.id !== id));
            };

            const addSemiannualPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setMonth(today.getMonth() + (semiannualPayments.length + 1) * 6);
                setSemiannualPayments([...semiannualPayments, { id: Date.now(), type: `Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ${semiannualPayments.length + 1}`, value: 50000, isPercentage: false, date: defaultDate.toISOString().split('T')[0] }]);
            };
            const updateSemiannualPayment = (id, field, value) => {
                setSemiannualPayments(semiannualPayments.map(p => p.id === id ? { ...p, [field]: value } : p ));
            };
            const deleteSemiannualPayment = (id) => {
                setSemiannualPayments(semiannualPayments.filter(p => p.id !== id));
            };

            const addQuarterlyPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setMonth(today.getMonth() + (quarterlyPayments.length + 1) * 3);
                setQuarterlyPayments([...quarterlyPayments, { id: Date.now(), type: `Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© ${quarterlyPayments.length + 1}`, value: 25000, isPercentage: false, date: defaultDate.toISOString().split('T')[0] }]);
            };
            const updateQuarterlyPayment = (id, field, value) => {
                setQuarterlyPayments(quarterlyPayments.map(p => p.id === id ? { ...p, [field]: value } : p ));
            };
            const deleteQuarterlyPayment = (id) => {
                setQuarterlyPayments(quarterlyPayments.filter(p => p.id !== id));
            };

            const addCustomPayment = () => {
                const today = new Date();
                const defaultDate = new Date(today);
                defaultDate.setFullYear(today.getFullYear() + 1);
                setCustomPayments([...customPayments, { id: Date.now(), type: 'Ø¯ÙØ¹Ø© Ù…Ø®ØµØµØ©', value: 100000, isPercentage: false, frequency: 'once', numberOfPayments: 1, startDate: defaultDate.toISOString().split('T')[0] }]);
            };
            const updateCustomPayment = (id, field, value) => {
                setCustomPayments(customPayments.map(p => p.id === id ? { ...p, [field]: value } : p ));
            };
            const deleteCustomPayment = (id) => {
                setCustomPayments(customPayments.filter(p => p.id !== id));
            };

            const calculateResults = () => {
                const project = getSelectedProject();
                if (!project) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹');
                    return;
                }
                if (!unitValue || unitValue <= 0) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø©');
                    return;
                }
                if (numberOfYears <= 0 && selectedPattern !== 'custom') {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª');
                    return;
                }
                
                // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ·
                const maxYears = project.maxInstallmentYears || 10;
                if (numberOfYears > maxYears && selectedPattern !== 'custom') {
                    alert(`âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¨Ø§Ø¦Ø¹:\n\nØ¹Ø¯Ø¯ Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² ${maxYears} Ø³Ù†ÙˆØ§Øª Ù„Ù…Ø´Ø±ÙˆØ¹ "${project.name}".\n\nØ¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø®Ù„: ${numberOfYears} Ø³Ù†ÙˆØ§Øª\nØ§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­: ${maxYears} Ø³Ù†ÙˆØ§Øª\n\nÙŠØ±Ø¬Ù‰ ØªÙ‚Ù„ÙŠÙ„ Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·.`);
                    return;
                }

                const engine = new SmartPaymentEngine(
                    unitValue, 
                    project.cashDiscountRate, 
                    project.discountRate, 
                    new Date()
                );

                let result = null;
                const downPayment = calculateDownPayment();

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
                const minDownPaymentValue = unitValue * (project.minDownPaymentPercent / 100);
                if (downPayment < minDownPaymentValue) {
                    alert(`âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¨Ø§Ø¦Ø¹:\n\nØ§Ù„Ù…Ù‚Ø¯Ù… Ø§Ù„Ù…Ø¯Ø®Ù„ (${formatCurrency(downPayment)}) Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ (${formatCurrency(minDownPaymentValue)}). ÙŠØ±Ø¬Ù‰ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ù….`);
                    return;
                }

                const annualPaymentsProcessed = annualPayments.map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date
                }));
                const semiannualPaymentsProcessed = semiannualPayments.map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date
                }));
                const quarterlyPaymentsProcessed = quarterlyPayments.map(p => ({
                    type: p.type,
                    amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                    date: p.date
                }));

                const commonParams = {
                    downPayment,
                    numberOfYears,
                    frequency,
                    annualPayments: annualPaymentsProcessed,
                    semiannualPayments: semiannualPaymentsProcessed,
                    quarterlyPayments: quarterlyPaymentsProcessed,
                    quarterlyStartDate: quarterlyStartDate || null,
                    installmentDay: installmentDay // ÙŠÙˆÙ… Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø·
                };

                try {
                    switch (selectedPattern) {
                        case 'equal':
                            result = engine.calculateEqualInstallments(commonParams);
                            break;
                        case 'decreasing':
                            result = engine.calculateDecreasingPayments({ ...commonParams, decreaseRate });
                            break;
                        case 'graduated':
                            result = engine.calculateGraduatedPayments({ ...commonParams, growthRate });
                            break;
                        case 'custom':
                            const customPaymentsProcessed = customPayments.map(p => ({
                                type: p.type,
                                amount: p.isPercentage ? unitValue * (p.value / 100) : p.value,
                                frequency: p.frequency,
                                numberOfPayments: p.numberOfPayments,
                                startDate: p.startDate
                            }));
                            result = engine.calculateCustomDistribution({
                                downPayment,
                                customPayments: customPaymentsProcessed,
                                quarterlyYears: customQuarterlyYears,
                                quarterlyStartDate: customQuarterlyStartDate || null,
                                installmentDay: installmentDay
                            });
                            break;
                    }

                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù„Ø£Ù‚Ø±Ø¨ 100 Ø¬) Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø¯ÙˆØ±ÙŠØ© 
                    let finalSchedule = applyAutoRoundingToSchedule(result.schedule);

                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±
                    if (isAdmin && roundingOption !== '100') {
                        finalSchedule = applyRoundingToSchedule(finalSchedule, roundingOption);
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø±Ø¨
                    const engineForVerification = new SmartPaymentEngine(
                        unitValue, 
                        project.cashDiscountRate, 
                        project.discountRate, 
                        new Date()
                    );
                    
                    result.schedule = finalSchedule;
                    result.summary = engineForVerification.calculateSummary(finalSchedule);
                    result.verification = engineForVerification.verifyScheduleXNPV(finalSchedule);

                    setResults(result);

                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                    if (project.baseSystem) {
                        const baseEngine = new SmartPaymentEngine(
                            unitValue, 
                            project.cashDiscountRate, 
                            project.discountRate, 
                            new Date()
                        );
                        let baseResult = baseEngine.calculateBaseSystem(project.baseSystem, unitValue);

                         // ØªØ·Ø¨ÙŠÙ‚ Ù†ÙØ³ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                        let baseFinalSchedule = applyAutoRoundingToSchedule(baseResult.schedule);
                        if (isAdmin && roundingOption !== '100') {
                            baseFinalSchedule = applyRoundingToSchedule(baseFinalSchedule, roundingOption);
                        }
                        
                        baseResult.schedule = baseFinalSchedule;
                        baseResult.summary = baseEngine.calculateSummary(baseFinalSchedule);
                        baseResult.verification = baseEngine.verifyScheduleXNPV(baseFinalSchedule);
                        
                        setBaseSystemResults(baseResult);
                    } else {
                        setBaseSystemResults(null);
                    }

                } catch (error) {
                    console.error("Calculation Error:", error);
                    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨: ${error.message}`);
                    setResults(null);
                    setBaseSystemResults(null);
                }
            };
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // Components
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            const ProjectManagerModal = () => (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 print-hidden" onClick={() => setShowProjectsManager(false)}>
                    <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-slide-in" onClick={(e) => e.stopPropagation()}>
                        <div className="bg-gradient-to-r from-gray-900 to-black px-8 py-6 text-white sticky top-0 rounded-t-2xl">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-2xl font-bold">ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
                                    <p className="text-sm text-gray-400">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆÙ…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø®ØµÙ….</p>
                                </div>
                                <button onClick={() => setShowProjectsManager(false)} className="text-gray-400 hover:text-white text-3xl font-light">Ã—</button>
                            </div>
                        </div>
                        <div className="p-8">
                            <div className="flex justify-end mb-6">
                                <button onClick={addProject} className="btn-premium gradient-info text-white px-6 py-2 rounded-xl text-lg flex items-center gap-2">
                                    â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                                </button>
                            </div>
                            <div className="space-y-4">
                                {projects.map(project => (
                                    <div key={project.id} className="glass-dark p-4 rounded-xl shadow-lg border-2 border-red-100">
                                        {editingProject === project.id ? (
                                            <div className="space-y-3">
                                                <input
                                                    type="text"
                                                    value={project.name}
                                                    onChange={(e) => updateProject(project.id, 'name', e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg modern-input text-lg font-bold"
                                                    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"
                                                />
                                                <input
                                                    type="text"
                                                    value={project.description}
                                                    onChange={(e) => updateProject(project.id, 'description', e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg modern-input text-sm"
                                                    placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"
                                                />
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label className="text-sm font-medium text-gray-700">Ø®ØµÙ… Ø§Ù„ÙƒØ§Ø´ (%)</label>
                                                        <input
                                                            type="number"
                                                            step="0.001"
                                                            value={project.cashDiscountRate}
                                                            onChange={(e) => updateProject(project.id, 'cashDiscountRate', parseFloat(e.target.value) || 0)}
                                                            className="w-full px-3 py-2 border rounded-lg modern-input"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-sm font-medium text-gray-700">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ÙØ¹ØªÙ…Ø¯ (%)</label>
                                                        <input
                                                            type="number"
                                                            step="0.001"
                                                            value={project.discountRate}
                                                            onChange={(e) => updateProject(project.id, 'discountRate', parseFloat(e.target.value) || 0)}
                                                            className="w-full px-3 py-2 border rounded-lg modern-input"
                                                            disabled={project.discountRateMode === 'auto'}
                                                        />
                                                        <span className="text-xs text-gray-500 block mt-1">
                                                            {project.discountRateMode === 'auto' ? 'ØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ' : 'ÙŠØ¯ÙˆÙŠ'}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label className="text-sm font-medium text-gray-700">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ù‚Ø¯Ù… (%)</label>
                                                        <input
                                                            type="number"
                                                            step="1"
                                                            value={project.minDownPaymentPercent}
                                                            onChange={(e) => updateProject(project.id, 'minDownPaymentPercent', parseFloat(e.target.value) || 0)}
                                                            className="w-full px-3 py-2 border rounded-lg modern-input"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-sm font-medium text-gray-700">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ·</label>
                                                        <input
                                                            type="number"
                                                            step="1"
                                                            value={project.maxInstallmentYears}
                                                            onChange={(e) => updateProject(project.id, 'maxInstallmentYears', parseInt(e.target.value) || 0)}
                                                            className="w-full px-3 py-2 border rounded-lg modern-input"
                                                        />
                                                    </div>
                                                </div>
                                                <div className="flex justify-end gap-3 mt-4">
                                                    <button 
                                                        onClick={() => {
                                                            setCurrentProjectForBaseSystem(project);
                                                            setTempBaseSystem(project.baseSystem || {});
                                                            setShowBaseSystemModal(true);
                                                        }}
                                                        className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm"
                                                    >
                                                        ğŸ§® ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                                                    </button>
                                                    <button onClick={() => setEditingProject(null)} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                                                        Ø­ÙØ¸
                                                    </button>
                                                    <button onClick={() => deleteProject(project.id)} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm">
                                                        Ø­Ø°Ù
                                                    </button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <h3 className="font-bold text-xl text-gray-900">{project.name}</h3>
                                                    <p className="text-sm text-gray-700">{project.description}</p>
                                                    <div className="flex gap-4 text-xs mt-2 text-gray-600">
                                                        <span>Ø®ØµÙ… ÙƒØ§Ø´: <span className="font-bold text-red-600">{project.cashDiscountRate}%</span></span>
                                                        <span>Ù…Ø¹Ø¯Ù„ Ø®ØµÙ…: <span className="font-bold text-blue-600">{project.discountRate.toFixed(3)}%</span></span>
                                                        <span>Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ù‚Ø¯Ù…: <span className="font-bold text-green-600">{project.minDownPaymentPercent}%</span></span>
                                                    </div>
                                                </div>
                                                <button onClick={() => setEditingProject(project.id)} className="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg text-sm">
                                                    ØªØ¹Ø¯ÙŠÙ„
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
            
            const BaseSystemModal = () => (
                showBaseSystemModal && currentProjectForBaseSystem && (
                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 print-hidden" onClick={() => setShowBaseSystemModal(false)}>
                        <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-slide-in" onClick={(e) => e.stopPropagation()}>
                            <div className="bg-gradient-to-r from-gray-900 to-black px-8 py-6 text-white sticky top-0 rounded-t-2xl">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-2xl font-bold">ğŸ§® ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h2>
                                        <p className="text-sm text-gray-400">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: {currentProjectForBaseSystem.name} | <span className="text-yellow-400">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø©: {formatCurrency(unitValue)}</span></p>
                                    </div>
                                    <button onClick={() => setShowBaseSystemModal(false)} className="text-gray-400 hover:text-white text-3xl font-light">Ã—</button>
                                </div>
                            </div>
                            <div className="p-8 space-y-6">
                                {/* Ø§Ù„Ù…Ù‚Ø¯Ù… */}
                                <div className="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                    <h3 className="font-bold text-lg text-gray-800 mb-2">Ø§Ù„Ù…Ù‚Ø¯Ù…</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={tempBaseSystem.downPaymentValue || ''}
                                            onChange={(e) => setTempBaseSystem({ ...tempBaseSystem, downPaymentValue: parseFloat(e.target.value) || 0 })}
                                            className="px-3 py-2 border rounded-lg modern-input col-span-2"
                                            placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…"
                                        />
                                        <select
                                            value={tempBaseSystem.downPaymentIsPercentage ? 'percentage' : 'value'}
                                            onChange={(e) => setTempBaseSystem({ ...tempBaseSystem, downPaymentIsPercentage: e.target.value === 'percentage' })}
                                            className="px-3 py-2 border rounded-lg modern-input bg-white"
                                        >
                                            <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                            <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                        </select>
                                    </div>
                                    <input
                                        type="date"
                                        value={tempBaseSystem.downPaymentDate || ''}
                                        onChange={(e) => setTempBaseSystem({ ...tempBaseSystem, downPaymentDate: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg modern-input mt-3 bg-white"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">ØªØ§Ø±ÙŠØ® Ø¯ÙØ¹ Ø§Ù„Ù…Ù‚Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</p>
                                </div>

                                {/* Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© */}
                                <div className="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-lg text-gray-800">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© (Annual Payments)</h3>
                                        <button onClick={() => {
                                            const newPayment = { value: 10, isPercentage: true, type: `Ø¯ÙØ¹Ø© Ø³Ù†ÙˆÙŠØ© ${tempBaseSystem.annualPayments.length + 1}`, date: null };
                                            setTempBaseSystem({ ...tempBaseSystem, annualPayments: [...(tempBaseSystem.annualPayments || []), newPayment] });
                                        }} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                                            â• Ø¥Ø¶Ø§ÙØ©
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        {(tempBaseSystem.annualPayments || []).map((p, index) => (
                                            <div key={index} className="flex gap-3 items-center bg-white p-3 rounded-lg border border-green-300">
                                                <input
                                                    type="text"
                                                    value={p.type}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.annualPayments];
                                                        updated[index].type = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, annualPayments: updated });
                                                    }}
                                                    className="w-32 px-3 py-2 border rounded-lg modern-input"
                                                />
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={p.value || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.annualPayments];
                                                        updated[index].value = parseFloat(e.target.value) || 0;
                                                        setTempBaseSystem({ ...tempBaseSystem, annualPayments: updated });
                                                    }}
                                                    className="w-24 px-3 py-2 border rounded-lg modern-input"
                                                    placeholder="Ù‚ÙŠÙ…Ø©"
                                                />
                                                <select
                                                    value={p.isPercentage ? 'percentage' : 'value'}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.annualPayments];
                                                        updated[index].isPercentage = e.target.value === 'percentage';
                                                        setTempBaseSystem({ ...tempBaseSystem, annualPayments: updated });
                                                    }}
                                                    className="px-3 py-2 border rounded-lg modern-input bg-white"
                                                >
                                                    <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                                    <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                                </select>
                                                <input
                                                    type="date"
                                                    value={p.date || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.annualPayments];
                                                        updated[index].date = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, annualPayments: updated });
                                                    }}
                                                    className="w-40 px-3 py-2 border rounded-lg modern-input bg-white"
                                                />
                                                <button onClick={() => {
                                                    const updated = tempBaseSystem.annualPayments.filter((_, i) => i !== index);
                                                    setTempBaseSystem({ ...tempBaseSystem, annualPayments: updated });
                                                }} className="text-red-600 hover:text-red-800 text-xl font-bold">
                                                    Ã—
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© */}
                                <div className="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-lg text-gray-800">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© (Semiannual Payments)</h3>
                                        <button onClick={() => {
                                            const newPayment = { value: 5, isPercentage: true, type: `Ø¯ÙØ¹Ø© Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ${tempBaseSystem.semiannualPayments.length + 1}`, date: null };
                                            setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: [...(tempBaseSystem.semiannualPayments || []), newPayment] });
                                        }} className="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm">
                                            â• Ø¥Ø¶Ø§ÙØ©
                                        </button>
                                    </div>
                                    {/* ... Ù†ÙØ³ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© ... */}
                                    <div className="space-y-3">
                                        {(tempBaseSystem.semiannualPayments || []).map((p, index) => (
                                            <div key={index} className="flex gap-3 items-center bg-white p-3 rounded-lg border border-yellow-300">
                                                <input
                                                    type="text"
                                                    value={p.type}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.semiannualPayments];
                                                        updated[index].type = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: updated });
                                                    }}
                                                    className="w-32 px-3 py-2 border rounded-lg modern-input"
                                                />
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={p.value || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.semiannualPayments];
                                                        updated[index].value = parseFloat(e.target.value) || 0;
                                                        setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: updated });
                                                    }}
                                                    className="w-24 px-3 py-2 border rounded-lg modern-input"
                                                    placeholder="Ù‚ÙŠÙ…Ø©"
                                                />
                                                <select
                                                    value={p.isPercentage ? 'percentage' : 'value'}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.semiannualPayments];
                                                        updated[index].isPercentage = e.target.value === 'percentage';
                                                        setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: updated });
                                                    }}
                                                    className="px-3 py-2 border rounded-lg modern-input bg-white"
                                                >
                                                    <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                                    <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                                </select>
                                                <input
                                                    type="date"
                                                    value={p.date || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.semiannualPayments];
                                                        updated[index].date = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: updated });
                                                    }}
                                                    className="w-40 px-3 py-2 border rounded-lg modern-input bg-white"
                                                />
                                                <button onClick={() => {
                                                    const updated = tempBaseSystem.semiannualPayments.filter((_, i) => i !== index);
                                                    setTempBaseSystem({ ...tempBaseSystem, semiannualPayments: updated });
                                                }} className="text-red-600 hover:text-red-800 text-xl font-bold">
                                                    Ã—
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© */}
                                <div className="p-4 bg-red-50 rounded-lg border-2 border-red-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-lg text-gray-800">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Quarterly Payments)</h3>
                                        <button onClick={() => {
                                            const newPayment = { value: 2.5, isPercentage: true, type: `Ø¯ÙØ¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© ${tempBaseSystem.quarterlyPayments.length + 1}`, date: null };
                                            setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: [...(tempBaseSystem.quarterlyPayments || []), newPayment] });
                                        }} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm">
                                            â• Ø¥Ø¶Ø§ÙØ©
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        {(tempBaseSystem.quarterlyPayments || []).map((p, index) => (
                                            <div key={index} className="flex gap-3 items-center bg-white p-3 rounded-lg border border-red-300">
                                                <input
                                                    type="text"
                                                    value={p.type}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.quarterlyPayments];
                                                        updated[index].type = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: updated });
                                                    }}
                                                    className="w-32 px-3 py-2 border rounded-lg modern-input"
                                                />
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={p.value || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.quarterlyPayments];
                                                        updated[index].value = parseFloat(e.target.value) || 0;
                                                        setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: updated });
                                                    }}
                                                    className="w-24 px-3 py-2 border rounded-lg modern-input"
                                                    placeholder="Ù‚ÙŠÙ…Ø©"
                                                />
                                                <select
                                                    value={p.isPercentage ? 'percentage' : 'value'}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.quarterlyPayments];
                                                        updated[index].isPercentage = e.target.value === 'percentage';
                                                        setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: updated });
                                                    }}
                                                    className="px-3 py-2 border rounded-lg modern-input bg-white"
                                                >
                                                    <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                                    <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                                </select>
                                                <input
                                                    type="date"
                                                    value={p.date || ''}
                                                    onChange={(e) => {
                                                        const updated = [...tempBaseSystem.quarterlyPayments];
                                                        updated[index].date = e.target.value;
                                                        setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: updated });
                                                    }}
                                                    className="w-40 px-3 py-2 border rounded-lg modern-input bg-white"
                                                />
                                                <button onClick={() => {
                                                    const updated = tempBaseSystem.quarterlyPayments.filter((_, i) => i !== index);
                                                    setTempBaseSystem({ ...tempBaseSystem, quarterlyPayments: updated });
                                                }} className="text-red-600 hover:text-red-800 text-xl font-bold">
                                                    Ã—
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© */}
                                <div className="p-4 bg-indigo-50 rounded-lg border-2 border-indigo-200">
                                    <h3 className="font-bold text-lg text-gray-800 mb-2">Ø³Ù†ÙˆØ§Øª ØªÙ‚Ø³ÙŠØ· Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø«Ù…Ù† (Ø£Ù‚Ø³Ø§Ø· Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ù…ÙˆØ­Ø¯Ø©)</h3>
                                    <input
                                        type="number"
                                        step="0.25"
                                        value={tempBaseSystem.quarterlyYears || ''}
                                        onChange={(e) => setTempBaseSystem({ ...tempBaseSystem, quarterlyYears: parseFloat(e.target.value) || 0 })}
                                        className="w-full px-3 py-2 border rounded-lg modern-input"
                                        placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª (Ù…Ø«Ø§Ù„: 8, 4, 0.25)"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ù‡ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ØªÙ‚Ø³ÙŠØ· Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©.</p>
                                </div>

                                <div className="flex justify-end gap-3 pt-4 border-t">
                                    <button onClick={() => setShowBaseSystemModal(false)} className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-xl text-lg">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                    <button onClick={calculateBaseSystemImpliedRate} className="btn-premium gradient-info text-white px-6 py-2 rounded-xl text-lg flex items-center gap-2">
                                        ğŸ’¾ Ø­ÙØ¸ ÙˆØ­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø®ØµÙ…
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            );

            const ComparisonModal = () => (
                showComparison && baseSystemResults && results && (
                    <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 print-hidden" onClick={() => setShowComparison(false)}>
                        <div className="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto animate-slide-in" onClick={(e) => e.stopPropagation()}>
                            <div className="bg-gradient-to-r from-red-600 to-red-800 px-8 py-6 text-white sticky top-0 rounded-t-2xl">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-2xl font-bold">ğŸ†š Ù…Ù‚Ø§Ø±Ù†Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø®Ø·Ø· Ø§Ù„Ø³Ø¯Ø§Ø¯</h2>
                                    <button onClick={() => setShowComparison(false)} className="text-gray-200 hover:text-white text-3xl font-light">Ã—</button>
                                </div>
                                <p className="text-sm text-gray-200 mt-1">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: {getSelectedProject().name} | Ø§Ù„ÙˆØ­Ø¯Ø©: {unitNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | Ø§Ù„Ù‚ÙŠÙ…Ø©: {formatCurrency(unitValue)}</p>
                            </div>
                            <div className="p-8">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                    <div className="bg-white rounded-lg p-4 shadow border border-gray-200">
                                        <p className="text-sm text-gray-600 mb-1">ÙØ±Ù‚ Ø§Ù„Ù…Ù‚Ø¯Ù…</p>
                                        <p className={`text-xl font-bold ${results.downPayment > baseSystemResults.downPayment ? 'text-green-600' : 'text-red-600'}`}>
                                            {formatCurrency(Math.abs(results.downPayment - baseSystemResults.downPayment))}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">
                                            {results.downPayment > baseSystemResults.downPayment ? 'â†‘ Ø£Ø¹Ù„Ù‰' : 'â†“ Ø£Ù‚Ù„'}
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-lg p-4 shadow border border-gray-200">
                                        <p className="text-sm text-gray-600 mb-1">ÙØ±Ù‚ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª</p>
                                        <p className={`text-xl font-bold ${(results.schedule.length - 1) < (baseSystemResults.schedule.length - 1) ? 'text-green-600' : 'text-red-600'}`}>
                                            {Math.abs((results.schedule.length - 1) - (baseSystemResults.schedule.length - 1))}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">
                                            {(results.schedule.length - 1) < (baseSystemResults.schedule.length - 1) ? 'Ø£Ù‚Ù„ Ø¯ÙØ¹Ø§Øª' : 'Ø£ÙƒØ«Ø± Ø¯ÙØ¹Ø§Øª'}
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-lg p-4 shadow border border-gray-200">
                                        <p className="text-sm text-gray-600 mb-1">ÙØ±Ù‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                                        <p className={`text-xl font-bold ${results.summary.totalPaid < baseSystemResults.summary.totalPaid ? 'text-green-600' : 'text-red-600'}`}>
                                            {formatCurrency(Math.abs(results.summary.totalPaid - baseSystemResults.summary.totalPaid))}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">
                                            {results.summary.totalPaid < baseSystemResults.summary.totalPaid ? 'â†“ Ø£Ù‚Ù„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ' : 'â†‘ Ø£Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-lg p-4 shadow border border-gray-200">
                                        <p className="text-sm text-gray-600 mb-1">ÙØ±Ù‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (PV)</p>
                                        <p className={`text-xl font-bold ${results.summary.totalPV > baseSystemResults.summary.totalPV ? 'text-green-600' : 'text-red-600'}`}>
                                            {formatCurrency(Math.abs(results.summary.totalPV - baseSystemResults.summary.totalPV))}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">
                                            {results.summary.totalPV > baseSystemResults.summary.totalPV ? 'â†‘ Ø£Ù‚Ø±Ø¨ Ù„Ù„ÙƒØ§Ø´' : 'â†“ Ø£Ø¨Ø¹Ø¯ Ø¹Ù† Ø§Ù„ÙƒØ§Ø´'}
                                        </p>
                                    </div>
                                </div>
                                
                                <h3 className="text-xl font-bold text-gray-800 mb-4">Ø¬Ø¯ÙˆÙ„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª</h3>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full bg-white comparison-table rounded-xl shadow-lg">
                                        <thead>
                                            <tr className="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                                <th className="py-3 px-6 text-right">#</th>
                                                <th className="py-3 px-6 text-right">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©</th>
                                                <th className="py-3 px-6 text-right font-bold text-red-700">Ø¯ÙØ¹Ø© Ù…Ù‚ØªØ±Ø­Ø© ({results.patternName})</th>
                                                <th className="py-3 px-6 text-right font-bold text-blue-700">Ø¯ÙØ¹Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                                                <th className="py-3 px-6 text-right">ÙØ±Ù‚ Ø§Ù„Ø¯ÙØ¹Ø©</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-gray-700 text-sm font-light">
                                            {results.schedule.map((p, index) => {
                                                const basePayment = baseSystemResults.schedule.find(bp => 
                                                    bp.type === p.type && (p.type === 'Ù…Ù‚Ø¯Ù…' || bp.id === p.id)
                                                ) || null;
                                                
                                                let baseAmount = basePayment?.amount || 0;
                                                let diff = p.amount - baseAmount;
                                                let diffClass = diff > 0 ? 'text-red-600 font-bold' : (diff < 0 ? 'text-green-600 font-bold' : '');

                                                return (
                                                    <tr key={index} className="border-b border-gray-200 hover:bg-gray-50">
                                                        <td className="py-3 px-6 text-right whitespace-nowrap">{p.id} - {p.type}</td>
                                                        <td className="py-3 px-6 text-right">{formatDate(p.date)}</td>
                                                        <td className="py-3 px-6 text-right font-bold text-red-800">{formatCurrency(p.amount)}</td>
                                                        <td className="py-3 px-6 text-right font-bold text-blue-800">{formatCurrency(baseAmount)}</td>
                                                        <td className={`py-3 px-6 text-right ${diffClass}`}>
                                                            {formatCurrency(diff)}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                            {/* ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */}
                                            <tr className="bg-gray-200 font-bold text-base">
                                                <td className="py-3 px-6 text-right">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                                <td className="py-3 px-6 text-right"></td>
                                                <td className="py-3 px-6 text-right text-red-800">{formatCurrency(results.summary.totalPaid)}</td>
                                                <td className="py-3 px-6 text-right text-blue-800">{formatCurrency(baseSystemResults.summary.totalPaid)}</td>
                                                <td className={`py-3 px-6 text-right ${results.summary.totalPaid < baseSystemResults.summary.totalPaid ? 'text-green-600' : 'text-red-600'}`}>
                                                    {formatCurrency(results.summary.totalPaid - baseSystemResults.summary.totalPaid)}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div className="flex justify-center mt-6">
                                    <button onClick={() => setShowComparison(false)} className="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-xl text-lg">
                                        Ø¥ØºÙ„Ø§Ù‚
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            );

            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // Main Render
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            return (
                <div className="min-h-screen p-4 md:p-8 bg-gray-100">
                    <div className="max-w-7xl mx-auto">
                        
                        {/* Header Section */}
                        <div className="glass-card gradient-dark p-8 text-white relative overflow-hidden print-hidden border-t-4 border-red-600">
                            <div className="absolute top-0 left-0 w-64 h-64 bg-red-600/10 rounded-full -translate-x-32 -translate-y-32"></div>
                            <div className="absolute bottom-0 right-0 w-96 h-96 bg-red-600/10 rounded-full translate-x-48 translate-y-48"></div>
                            <div className="relative z-10">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h1 className="text-4xl font-bold mb-2">ğŸ¢ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…Ø±Ù†</h1>
                                        <p className="text-gray-300 text-lg">BETA SMART FINANCE | Ø´Ø±ÙƒØ© Ø¨ÙŠØªØ§ Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ <span className="text-red-500 font-bold">SINCE 1993</span></p>
                                    </div>
                                    <button onClick={() => isAdmin ? setIsAdmin(false) : setShowAdminPanel(true)} className="bg-red-600/80 hover:bg-red-600 px-6 py-3 rounded-xl backdrop-blur-lg transition">
                                        {isAdmin ? 'ğŸ”’ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¯ÙŠØ±' : 'âš™ï¸ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±'}
                                    </button>
                                </div>
                                {isAdmin && (
                                    <div className="mt-4 flex items-center gap-4">
                                        <span className="badge badge-pro">PRO MODE</span>
                                        <button onClick={() => setShowProjectsManager(true)} className="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm transition">
                                            âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Admin Login Panel */}
                        {showAdminPanel && (
                            <div className="glass-card bg-white p-6 mt-4 rounded-xl shadow-lg print-hidden animate-fade-in">
                                <h3 className="font-bold text-gray-800 mb-3">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
                                <div className="flex gap-3">
                                    <input 
                                        type="password" 
                                        value={adminPassword} 
                                        onChange={(e) => setAdminPassword(e.target.value)}
                                        placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                                        className="flex-1 modern-input px-4 py-2"
                                    />
                                    <button onClick={handleAdminLogin} className="btn-premium gradient-dark text-white px-6 py-2 rounded-lg">
                                        Ø¯Ø®ÙˆÙ„
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Project Manager Modal */}
                        {showProjectsManager && isAdmin && <ProjectManagerModal />}

                        {/* Base System Modal */}
                        <BaseSystemModal />

                        {/* Main Content Area */}
                        <div className="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            {/* Input Panel - Col 1 */}
                            <div className="lg:col-span-1 space-y-6 print-hidden">
                                
                                {/* Project Selector */}
                                <div className="glass-card p-6 rounded-xl shadow-lg space-y-4">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
                                    <div className="grid grid-cols-1 gap-4">
                                        {projects.map(project => (
                                            <button 
                                                key={project.id} 
                                                onClick={() => setSelectedProjectId(project.id)}
                                                className={`p-4 rounded-xl border-2 transition-all text-right ${
                                                    selectedProjectId === project.id ? 'border-red-600 bg-red-50 shadow-md' : 'bg-white border-gray-300 hover:border-red-400'
                                                }`}
                                            >
                                                <h3 className="font-bold text-lg text-gray-800 mb-1">{project.name}</h3>
                                                <p className="text-sm text-gray-600 mb-2">{project.description}</p>
                                                <div className="text-xs text-gray-500 space-y-1">
                                                    <div className="bg-gray-100 px-2 py-1 rounded">Ø®ØµÙ… ÙƒØ§Ø´: {project.cashDiscountRate}%</div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* Unit & Pattern Input */}
                                <div className="glass-card p-6 rounded-xl shadow-lg space-y-4">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ®Ø·Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</h3>
                                    
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-1">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø© (Ø¬)</label>
                                        <input
                                            type="number"
                                            step="1000"
                                            value={unitValue}
                                            onChange={(e) => setUnitValue(parseFloat(e.target.value) || 0)}
                                            className="w-full modern-input px-4 py-2 text-lg font-bold"
                                            placeholder="Ù…Ø«Ø§Ù„: 1,500,000"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø© / Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                        <input
                                            type="text"
                                            value={unitNumber}
                                            onChange={(e) => setUnitNumber(e.target.value)}
                                            className="w-full modern-input px-4 py-2"
                                            placeholder="Ù…Ø«Ø§Ù„: A-101 / Ø§Ù„Ø³ÙŠØ¯ Ø£Ø­Ù…Ø¯"
                                        />
                                    </div>

                                    {/* Payment Pattern Selector */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">Ù†ÙˆØ¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø³ÙŠØ·</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            {patterns.map(pattern => (
                                                <button 
                                                    key={pattern.id}
                                                    onClick={() => setSelectedPattern(pattern.id)}
                                                    className={`p-4 rounded-xl border-2 transition-all text-right ${
                                                        selectedPattern === pattern.id ? `border-${pattern.color}-600 bg-${pattern.color}-50 shadow-md` : 'bg-white border-gray-300 hover:border-red-400'
                                                    }`}
                                                >
                                                    <p className="text-xl font-bold mb-1">{pattern.icon} {pattern.name}</p>
                                                    <p className="text-xs text-gray-500">{pattern.description}</p>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Payment Details & Results - Col 2 & 3 */}
                            <div className="lg:col-span-2 space-y-6">
                                
                                {/* Dynamic Input Panel */}
                                <div className="glass-card p-6 rounded-xl shadow-lg animate-fade-in print-hidden">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">ØªÙƒÙˆÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­</h3>

                                    {/* Down Payment & Installment Day */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div className="p-4 bg-red-50 rounded-lg border-2 border-red-200">
                                            <label className="block text-sm font-bold text-gray-700 mb-2">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…</label>
                                            <div className="flex gap-3">
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={downPaymentValue}
                                                    onChange={(e) => setDownPaymentValue(parseFloat(e.target.value) || 0)}
                                                    className="flex-1 modern-input px-4 py-2"
                                                    placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©"
                                                />
                                                <select
                                                    value={downPaymentIsPercentage ? 'percentage' : 'value'}
                                                    onChange={(e) => setDownPaymentIsPercentage(e.target.value === 'percentage')}
                                                    className="px-4 py-2 border rounded-lg modern-input bg-white"
                                                >
                                                    <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                                    <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                                </select>
                                            </div>
                                            {unitValue > 0 && calculateDownPayment() < (unitValue * (getSelectedProject().minDownPaymentPercent / 100)) && (
                                                <div className="mt-2 p-2 bg-red-100 rounded">
                                                    <p className="text-red-700 text-xs"> âš ï¸ Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙ‚Ù„ Ø¹Ù† {getSelectedProject().minDownPaymentPercent || 5}% Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ </p>
                                                    <p className="text-red-600 text-xs mt-1"> Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {(downPaymentIsPercentage ? downPaymentValue : (downPaymentValue / unitValue) * 100).toFixed(2)}% | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: {formatCurrency(unitValue * (getSelectedProject().minDownPaymentPercent || 5) / 100)} </p>
                                                </div>
                                            )}
                                        </div>

                                        <div className="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                            <label className="block text-sm font-bold text-gray-700 mb-2">ÙŠÙˆÙ… Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø³Ø·</label>
                                            <div className="flex gap-3">
                                                <label className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg cursor-pointer transition-all border-2 ${installmentDay === 1 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white border-gray-300 hover:border-blue-400'}`}>
                                                    <input type="radio" name="installmentDayCustom" value="1" checked={installmentDay === 1} onChange={() => setInstallmentDay(1)} className="hidden" />
                                                    <span className="font-bold">ÙŠÙˆÙ… 1</span>
                                                </label>
                                                <label className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg cursor-pointer transition-all border-2 ${installmentDay === 15 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white border-gray-300 hover:border-blue-400'}`}>
                                                    <input type="radio" name="installmentDayCustom" value="15" checked={installmentDay === 15} onChange={() => setInstallmentDay(15)} className="hidden" />
                                                    <span className="font-bold">ÙŠÙˆÙ… 15</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Inputs for Equal, Decreasing, Graduated */}
                                    {(selectedPattern === 'equal' || selectedPattern === 'decreasing' || selectedPattern === 'graduated') && (
                                        <div className="p-4 bg-gray-50 rounded-lg border-2 border-gray-200 space-y-4">
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                {/* Number of Years */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-1">Ù…Ø¯Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø³Ù†ÙˆØ§Øª)</label>
                                                    <input
                                                        type="number"
                                                        step="1"
                                                        value={numberOfYears}
                                                        onChange={(e) => setNumberOfYears(parseInt(e.target.value) || 0)}
                                                        className="w-full modern-input px-4 py-2"
                                                        placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª"
                                                    />
                                                </div>

                                                {/* Frequency */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-1">ØªØ±Ø¯Ø¯ Ø§Ù„Ù‚Ø³Ø·</label>
                                                    <select
                                                        value={frequency}
                                                        onChange={(e) => setFrequency(parseInt(e.target.value))}
                                                        className="w-full modern-input px-4 py-2 bg-white"
                                                    >
                                                        <option value={12}>Ø´Ù‡Ø±ÙŠ (12)</option>
                                                        <option value={4}>Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ (4)</option>
                                                        <option value={2}>Ù†ØµÙ Ø³Ù†ÙˆÙŠ (2)</option>
                                                        <option value={1}>Ø³Ù†ÙˆÙŠ (1)</option>
                                                    </select>
                                                </div>

                                                {/* Growth/Decrease Rate */}
                                                {(selectedPattern === 'decreasing' || selectedPattern === 'graduated') && (
                                                    <div>
                                                        <label className="block text-sm font-bold text-gray-700 mb-1">
                                                            {selectedPattern === 'decreasing' ? 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ†Ø§Ù‚Øµ Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%)' : 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ²Ø§ÙŠØ¯ Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%)'}
                                                        </label>
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            value={selectedPattern === 'decreasing' ? decreaseRate : growthRate}
                                                            onChange={(e) => {
                                                                if (selectedPattern === 'decreasing') setDecreaseRate(parseFloat(e.target.value) || 0);
                                                                else setGrowthRate(parseFloat(e.target.value) || 0);
                                                            }}
                                                            className="w-full modern-input px-4 py-2"
                                                            placeholder="Ø§Ù„Ù†Ø³Ø¨Ø© %"
                                                        />
                                                    </div>
                                                )}
                                            </div>

                                            {/* Quarterly Start Date - Optional */}
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                                <input
                                                    type="date"
                                                    value={quarterlyStartDate}
                                                    onChange={(e) => setQuarterlyStartDate(e.target.value)}
                                                    className="w-full modern-input px-4 py-2 bg-white"
                                                    placeholder="ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø·"
                                                />
                                                <p className="text-xs text-gray-500 mt-1">ÙŠØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ {12/frequency} Ø£Ø´Ù‡Ø± Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</p>
                                            </div>

                                            {/* Additional Payments Section */}
                                            <div className="space-y-4">
                                                {/* Annual Payments */}
                                                <div className="p-3 bg-green-100 rounded-lg border border-green-300">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h4 className="font-bold text-md text-gray-800">Ø¯ÙØ¹Ø§Øª Ø³Ù†ÙˆÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©</h4>
                                                        <button onClick={addAnnualPayment} className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-xs">
                                                            â• Ø¥Ø¶Ø§ÙØ©
                                                        </button>
                                                    </div>
                                                    {annualPayments.map(p => (
                                                        <div key={p.id} className="flex gap-2 items-center text-sm mt-2 bg-white p-2 rounded border">
                                                            <input type="text" value={p.type} onChange={(e) => updateAnnualPayment(p.id, 'type', e.target.value)} placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙØ¹Ø©" className="px-2 py-1 border rounded w-24" />
                                                            <input type="number" value={p.value} onChange={(e) => updateAnnualPayment(p.id, 'value', parseFloat(e.target.value))} placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" className="px-2 py-1 border rounded w-20" />
                                                            <select value={p.isPercentage ? 'percentage' : 'value'} onChange={(e) => updateAnnualPayment(p.id, 'isPercentage', e.target.value === 'percentage')} className="px-2 py-1 border rounded bg-white w-20">
                                                                <option value="percentage">%</option>
                                                                <option value="value">Ø¬</option>
                                                            </select>
                                                            <input type="date" value={p.date} onChange={(e) => updateAnnualPayment(p.id, 'date', e.target.value)} className="px-2 py-1 border rounded bg-white flex-1" />
                                                            <button onClick={() => deleteAnnualPayment(p.id)} className="text-red-600 hover:text-red-800 text-lg font-bold">Ã—</button>
                                                        </div>
                                                    ))}
                                                </div>

                                                {/* Semiannual Payments */}
                                                <div className="p-3 bg-yellow-100 rounded-lg border border-yellow-300">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h4 className="font-bold text-md text-gray-800">Ø¯ÙØ¹Ø§Øª Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©</h4>
                                                        <button onClick={addSemiannualPayment} className="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded-lg text-xs">
                                                            â• Ø¥Ø¶Ø§ÙØ©
                                                        </button>
                                                    </div>
                                                    {semiannualPayments.map(p => (
                                                        <div key={p.id} className="flex gap-2 items-center text-sm mt-2 bg-white p-2 rounded border">
                                                            <input type="text" value={p.type} onChange={(e) => updateSemiannualPayment(p.id, 'type', e.target.value)} placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙØ¹Ø©" className="px-2 py-1 border rounded w-24" />
                                                            <input type="number" value={p.value} onChange={(e) => updateSemiannualPayment(p.id, 'value', parseFloat(e.target.value))} placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" className="px-2 py-1 border rounded w-20" />
                                                            <select value={p.isPercentage ? 'percentage' : 'value'} onChange={(e) => updateSemiannualPayment(p.id, 'isPercentage', e.target.value === 'percentage')} className="px-2 py-1 border rounded bg-white w-20">
                                                                <option value="percentage">%</option>
                                                                <option value="value">Ø¬</option>
                                                            </select>
                                                            <input type="date" value={p.date} onChange={(e) => updateSemiannualPayment(p.id, 'date', e.target.value)} className="px-2 py-1 border rounded bg-white flex-1" />
                                                            <button onClick={() => deleteSemiannualPayment(p.id)} className="text-red-600 hover:text-red-800 text-lg font-bold">Ã—</button>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                {/* Quarterly Payments (Specific) */}
                                                <div className="p-3 bg-red-100 rounded-lg border border-red-300">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h4 className="font-bold text-md text-gray-800">Ø¯ÙØ¹Ø§Øª Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ù…Ø­Ø¯Ø¯Ø© (ØºÙŠØ± Ø£Ù‚Ø³Ø§Ø· Ø¯ÙˆØ±ÙŠØ©)</h4>
                                                        <button onClick={addQuarterlyPayment} className="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-xs">
                                                            â• Ø¥Ø¶Ø§ÙØ©
                                                        </button>
                                                    </div>
                                                    {quarterlyPayments.map(p => (
                                                        <div key={p.id} className="flex gap-2 items-center text-sm mt-2 bg-white p-2 rounded border">
                                                            <input type="text" value={p.type} onChange={(e) => updateQuarterlyPayment(p.id, 'type', e.target.value)} placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙØ¹Ø©" className="px-2 py-1 border rounded w-24" />
                                                            <input type="number" value={p.value} onChange={(e) => updateQuarterlyPayment(p.id, 'value', parseFloat(e.target.value))} placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" className="px-2 py-1 border rounded w-20" />
                                                            <select value={p.isPercentage ? 'percentage' : 'value'} onChange={(e) => updateQuarterlyPayment(p.id, 'isPercentage', e.target.value === 'percentage')} className="px-2 py-1 border rounded bg-white w-20">
                                                                <option value="percentage">%</option>
                                                                <option value="value">Ø¬</option>
                                                            </select>
                                                            <input type="date" value={p.date} onChange={(e) => updateQuarterlyPayment(p.id, 'date', e.target.value)} className="px-2 py-1 border rounded bg-white flex-1" />
                                                            <button onClick={() => deleteQuarterlyPayment(p.id)} className="text-red-600 hover:text-red-800 text-lg font-bold">Ã—</button>
                                                        </div>
                                                    ))}
                                                </div>

                                            </div>
                                        </div>
                                    )}

                                    {/* Inputs for Custom Distribution */}
                                    {selectedPattern === 'custom' && (
                                        <div className="space-y-6">
                                            <div className="p-4 bg-amber-50 rounded-lg border-2 border-amber-200">
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="font-bold text-lg">Ø¯ÙØ¹Ø§Øª Ù…Ø®ØµØµØ©</h3>
                                                    <button onClick={addCustomPayment} className="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg text-sm">
                                                        â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©
                                                    </button>
                                                </div>
                                                {customPayments.length > 0 && (
                                                    <div className="space-y-3">
                                                        {customPayments.map((payment) => (
                                                            <div key={payment.id} className="bg-white p-3 rounded-lg border border-amber-300">
                                                                <div className="grid grid-cols-1 md:grid-cols-6 gap-3">
                                                                    <input
                                                                        type="text"
                                                                        value={payment.type}
                                                                        onChange={(e) => updateCustomPayment(payment.id, 'type', e.target.value)}
                                                                        placeholder="Ø§Ø³Ù…"
                                                                        className="px-3 py-2 border rounded"
                                                                    />
                                                                    <div className="flex gap-2">
                                                                        <input
                                                                            type="number"
                                                                            value={payment.value}
                                                                            onChange={(e) => updateCustomPayment(payment.id, 'value', parseFloat(e.target.value))}
                                                                            placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©"
                                                                            className="flex-1 px-3 py-2 border rounded"
                                                                        />
                                                                        <select
                                                                            value={payment.isPercentage ? 'percentage' : 'value'}
                                                                            onChange={(e) => updateCustomPayment(payment.id, 'isPercentage', e.target.value === 'percentage')}
                                                                            className="px-3 py-2 border rounded bg-white"
                                                                        >
                                                                            <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                                                            <option value="value">Ù‚ÙŠÙ…Ø© Ø¬</option>
                                                                        </select>
                                                                    </div>
                                                                    <select
                                                                        value={payment.frequency}
                                                                        onChange={(e) => updateCustomPayment(payment.id, 'frequency', e.target.value)}
                                                                        className="px-3 py-2 border rounded"
                                                                    >
                                                                        <option value="once">Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                                                                        <option value="quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 3 Ø´Ù‡ÙˆØ±)</option>
                                                                        <option value="semiannual">Ù†ØµÙ Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 6 Ø´Ù‡ÙˆØ±)</option>
                                                                        <option value="annual">Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 12 Ø´Ù‡Ø±)</option>
                                                                    </select>
                                                                    {payment.frequency !== 'once' && (
                                                                        <div className="flex items-center">
                                                                            <input
                                                                                type="number"
                                                                                value={payment.numberOfPayments}
                                                                                onChange={(e) => updateCustomPayment(payment.id, 'numberOfPayments', parseInt(e.target.value))}
                                                                                placeholder="Ø§Ù„Ø¹Ø¯Ø¯"
                                                                                className="w-full px-3 py-2 border rounded"
                                                                            />
                                                                        </div>
                                                                    )}
                                                                    <input
                                                                        type="date"
                                                                        value={payment.startDate}
                                                                        onChange={(e) => updateCustomPayment(payment.id, 'startDate', e.target.value)}
                                                                        className="px-3 py-2 border rounded bg-white"
                                                                    />
                                                                    <div className="flex items-center justify-center">
                                                                        <button onClick={() => deleteCustomPayment(payment.id)} className="text-red-600 hover:text-red-800 text-xl font-bold">Ã—</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>

                                            <div className="p-4 bg-indigo-50 rounded-lg border-2 border-indigo-200 space-y-3">
                                                <h3 className="font-bold text-lg">Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø«Ù…Ù† (Ø£Ù‚Ø³Ø§Ø· Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ù…ÙˆØ­Ø¯Ø©)</h3>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-sm font-bold text-gray-700 mb-1">Ù…Ø¯Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø³Ù†ÙˆØ§Øª)</label>
                                                        <input
                                                            type="number"
                                                            step="0.25"
                                                            value={customQuarterlyYears}
                                                            onChange={(e) => setCustomQuarterlyYears(parseFloat(e.target.value) || 0)}
                                                            className="w-full modern-input px-4 py-2"
                                                            placeholder="Ù…Ø«Ø§Ù„: 8, 4, 0.25"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                                        <input
                                                            type="date"
                                                            value={customQuarterlyStartDate}
                                                            onChange={(e) => setCustomQuarterlyStartDate(e.target.value)}
                                                            className="w-full modern-input px-4 py-2 bg-white"
                                                            placeholder="ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø·"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Ø®ÙŠØ§Ø± ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚Ø³Ø· - Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· */}
                                    {isAdmin && (
                                        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border-2 border-amber-200 mt-6">
                                            <label className="block text-sm font-bold text-gray-700 mb-3">
                                                <span className="flex items-center gap-2"> 
                                                    <span>ğŸ¯</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù‚Ø³Ø· (Ù„Ù„Ù…Ø¯ÙŠØ±) 
                                                </span>
                                            </label>
                                            <div className="mb-3 p-2 bg-green-100 rounded-lg border border-green-300">
                                                <p className="text-green-700 text-sm"> 
                                                    âœ… <strong>ØªÙ„Ù‚Ø§Ø¦ÙŠ:</strong> ÙŠØªÙ… ØªÙ‚Ø±ÙŠØ¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø£Ù‚Ø±Ø¨ 100 Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ 
                                                </p>
                                            </div>
                                            <p className="text-sm text-gray-600 mb-2">ØªÙ‚Ø±ÙŠØ¨ Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</p>
                                            <div className="flex flex-wrap gap-3">
                                                <label className={`flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer transition-all ${roundingOption === 'none' ? 'bg-amber-500 text-white' : 'bg-white border-2 border-gray-300 hover:border-amber-400'}`}>
                                                    <input type="radio" name="rounding" value="none" checked={roundingOption === 'none'} onChange={(e) => setRoundingOption(e.target.value)} className="hidden" />
                                                    <span className="font-bold">Ø¨Ù„Ø§ ØªÙ‚Ø±ÙŠØ¨ Ø¥Ø¶Ø§ÙÙŠ</span>
                                                </label>
                                                <label className={`flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer transition-all ${roundingOption === '500' ? 'bg-amber-500 text-white' : 'bg-white border-2 border-gray-300 hover:border-amber-400'}`}>
                                                    <input type="radio" name="rounding" value="500" checked={roundingOption === '500'} onChange={(e) => setRoundingOption(e.target.value)} className="hidden" />
                                                    <span className="font-bold">Ù„Ø£Ù‚Ø±Ø¨ 500 Ø¬</span>
                                                </label>
                                                <label className={`flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer transition-all ${roundingOption === '1000' ? 'bg-amber-500 text-white' : 'bg-white border-2 border-gray-300 hover:border-amber-400'}`}>
                                                    <input type="radio" name="rounding" value="1000" checked={roundingOption === '1000'} onChange={(e) => setRoundingOption(e.target.value)} className="hidden" />
                                                    <span className="font-bold">Ù„Ø£Ù‚Ø±Ø¨ 1000 Ø¬</span>
                                                </label>
                                                <label className={`flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer transition-all ${roundingOption === '100' ? 'bg-amber-500 text-white' : 'bg-white border-2 border-gray-300 hover:border-amber-400'}`}>
                                                    <input type="radio" name="rounding" value="100" checked={roundingOption === '100'} onChange={(e) => setRoundingOption(e.target.value)} className="hidden" />
                                                    <span className="font-bold">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ (Ø¨Ù‚Ø§Ø¡ 100 ØªÙ„Ù‚Ø§Ø¦ÙŠ)</span>
                                                </label>
                                            </div>
                                        </div>
                                    )}

                                    {/* Calculate Button */}
                                    <div className="mt-6 flex justify-center">
                                        <button onClick={calculateResults} className="btn-premium gradient-primary text-white text-2xl font-bold px-12 py-4 rounded-xl shadow-2xl shadow-red-500/50">
                                            Ø­Ø³Ø§Ø¨ Ø®Ø·Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Base System Summary (for comparison) */}
                                {getSelectedProject()?.baseSystem && unitValue > 0 && selectedPattern !== 'custom' && (
                                    <div className="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-gray-300 print-hidden">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-bold text-lg text-gray-800">ğŸ“‹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
                                            <button onClick={() => { calculateResults(); setShowComparison(true); }} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm" > 
                                                ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© 
                                            </button>
                                        </div>
                                        <div className="text-sm text-gray-700 space-y-1">
                                            <p><span className="font-bold">Ø§Ù„Ù…Ù‚Ø¯Ù…:</span> {getSelectedProject().baseSystem.downPaymentValue}{getSelectedProject().baseSystem.downPaymentIsPercentage ? '%' : ' Ø¬'} ({formatCurrency(unitValue * (getSelectedProject().baseSystem.downPaymentIsPercentage ? getSelectedProject().baseSystem.downPaymentValue / 100 : 1) || getSelectedProject().baseSystem.downPaymentValue)})</p>
                                            <p><span className="font-bold">Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ·:</span> {getSelectedProject().baseSystem.quarterlyYears} Ø³Ù†ÙˆØ§Øª</p>
                                            <p><span className="font-bold">Ø¯ÙØ¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø³Ù†ÙˆÙŠØ©:</span> {getSelectedProject().baseSystem.annualPayments.length} | <span className="font-bold">Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©:</span> {getSelectedProject().baseSystem.semiannualPayments.length} | <span className="font-bold">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ù…Ø­Ø¯Ø¯Ø©:</span> {getSelectedProject().baseSystem.quarterlyPayments.length}</p>
                                        </div>
                                    </div>
                                )}
                                
                                {/* Results Panel */}
                                {results && (
                                    <div id="print-area" className="glass-card p-6 rounded-xl shadow-2xl animate-fade-in">
                                        <div className="flex items-center justify-between mb-4 print-hidden">
                                            <div>
                                                <h2 className="text-2xl font-bold text-gray-800">âœ… Ø®Ø·Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ - {results.patternName}</h2>
                                            </div>
                                            <div className="flex gap-3">
                                                {baseSystemResults && (
                                                    <button onClick={() => setShowComparison(true)} className="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg">
                                                        ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ù…ØªÙ‚Ø¯Ù…Ø©
                                                    </button>
                                                )}
                                                <button onClick={handlePrint} className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg flex items-center gap-2">
                                                    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                                                </button>
                                            </div>
                                        </div>

                                        {/* Print Header */}
                                        <div className="print-only mb-6">
                                            <h2 className="text-2xl font-bold text-gray-800 text-center mb-4">Ø®Ø·Ø© Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø© - {getSelectedProject()?.name}</h2>
                                            <div className="grid grid-cols-2 gap-4 text-lg border-b pb-4">
                                                <div><span className="font-bold">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</span> {getSelectedProject()?.name}</div>
                                                <div><span className="font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¯Ø§Ø¯:</span> {results.patternName}</div>
                                                <div><span className="font-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø©:</span> {formatCurrency(unitValue)}</div>
                                                <div><span className="font-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒØ§Ø´ (PV):</span> {formatCurrency(getSelectedProject()?.cashDiscountRate ? unitValue * (1 - getSelectedProject().cashDiscountRate / 100) : unitValue)}</div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 text-lg pt-2">
                                                <div><span className="font-bold">Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©/Ø§Ù„Ø¹Ù…ÙŠÙ„:</span> {unitNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                                <div><span className="font-bold">Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·:</span> {results.pattern !== 'custom' ? `${numberOfYears} Ø³Ù†ÙˆØ§Øª (${results.schedule.filter(p => p.type.includes('Ù‚Ø³Ø·')).length} Ù‚Ø³Ø·)` : 'Ù…Ø®ØµØµ'}</div>
                                            </div>
                                        </div>

                                        {/* Main Summary Boxes */}
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className="bg-white rounded-lg p-4 text-center shadow">
                                                <p className="text-sm text-gray-600 mb-1">Ø§Ù„Ù…Ù‚Ø¯Ù…</p>
                                                <p className="text-xl font-bold text-gray-800">{formatCurrency(results.downPayment)}</p>
                                            </div>
                                            <div className="bg-white rounded-lg p-4 text-center shadow">
                                                <p className="text-sm text-gray-600 mb-1">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø£ÙˆÙ„</p>
                                                <p className="text-xl font-bold text-red-600">
                                                    {formatCurrency(results.installmentAmount || results.baseInstallment || results.schedule.find(p => p.type.includes('Ù‚Ø³Ø·'))?.amount || 0)}
                                                </p>
                                            </div>
                                            <div className="bg-white rounded-lg p-4 text-center shadow">
                                                <p className="text-sm text-gray-600 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª</p>
                                                <p className="text-xl font-bold text-gray-800">{results.schedule.length - 1}</p>
                                            </div>
                                            <div className="bg-white rounded-lg p-4 text-center shadow">
                                                <p className="text-sm text-gray-600 mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹</p>
                                                <p className="text-xl font-bold text-green-600">{formatCurrency(results.summary.totalPaid)}</p>
                                            </div>
                                        </div>
                                        
                                        {/* Schedule Table */}
                                        <div className="mt-6 overflow-x-auto">
                                            <h3 className="text-lg font-bold text-gray-800 mb-3">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…ÙØµÙ„</h3>
                                            <table className="min-w-full bg-white border-collapse border border-gray-200 shadow-md rounded-xl">
                                                <thead>
                                                    <tr className="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                                        <th className="py-3 px-6 text-right border-b border-gray-200">#</th>
                                                        <th className="py-3 px-6 text-right border-b border-gray-200">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©</th>
                                                        <th className="py-3 px-6 text-right border-b border-gray-200">Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹Ø©</th>
                                                        <th className="py-3 px-6 text-right border-b border-gray-200">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬)</th>
                                                        {isAdmin && <th className="py-3 px-6 text-right border-b border-gray-200 print-hidden">PV</th>}
                                                        {isAdmin && <th className="py-3 px-6 text-right border-b border-gray-200 print-hidden">Ø§Ù„Ø®ØµÙ…</th>}
                                                    </tr>
                                                </thead>
                                                <tbody className="text-gray-700 text-sm font-light">
                                                    {results.schedule.map((p, index) => (
                                                        <tr key={index} className={`border-b border-gray-200 hover:bg-gray-50 ${p.type === 'Ù…Ù‚Ø¯Ù…' ? 'bg-blue-50 font-bold' : ''}`}>
                                                            <td className="py-3 px-6 text-right whitespace-nowrap">{p.id}</td>
                                                            <td className="py-3 px-6 text-right whitespace-nowrap">{formatDate(p.date)}</td>
                                                            <td className="py-3 px-6 text-right whitespace-nowrap">{p.type}</td>
                                                            <td className="py-3 px-6 text-right whitespace-nowrap font-bold text-lg">{formatCurrency(p.amount)}</td>
                                                            {isAdmin && <td className="py-3 px-6 text-right whitespace-nowrap print-hidden">{formatCurrency(p.pv)}</td>}
                                                            {isAdmin && <td className="py-3 px-6 text-right whitespace-nowrap print-hidden">{formatCurrency(p.discount)}</td>}
                                                        </tr>
                                                    ))}
                                                    <tr className="bg-gray-200 font-bold text-base">
                                                        <td className="py-3 px-6 text-right" colSpan={isAdmin ? 3 : 2}>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                                        <td className="py-3 px-6 text-right text-green-700">{formatCurrency(results.summary.totalPaid)}</td>
                                                        {isAdmin && <td className="py-3 px-6 text-right print-hidden text-blue-700">{formatCurrency(results.summary.totalPV)}</td>}
                                                        {isAdmin && <td className="py-3 px-6 text-right print-hidden text-red-700">{formatCurrency(results.summary.totalDiscount)}</td>}
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        {/* Footer Print Info */}
                                        <div className="print-only mt-8">
                                            <div className="grid grid-cols-3 gap-4 border-t pt-4 text-sm">
                                                <div>
                                                    <p className="text-gray-600">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (PV)</p>
                                                    <p className="font-bold text-blue-700">{formatCurrency(results.summary.totalPV)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…</p>
                                                    <p className="font-bold text-red-700">{formatCurrency(results.summary.totalDiscount)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-gray-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„ÙØ¹Ù„ÙŠ</p>
                                                    <p className="font-bold text-orange-700">{results.summary.effectiveInterestRate.toFixed(2)}%</p>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-8 grid grid-cols-2 gap-8">
                                                <div className="text-center">
                                                    <div className="border-b border-dashed border-gray-400 h-10 mb-2"></div>
                                                    <p className="font-bold">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
                                                </div>
                                                <div className="text-center">
                                                    <div className="border-b border-dashed border-gray-400 h-10 mb-2"></div>
                                                    <p className="font-bold">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ©</p>
                                                </div>
                                            </div>
                                            <div className="text-center mt-8 text-sm text-gray-600">
                                                <p>Ø´Ø±ÙƒØ© Ø¨ÙŠØªØ§ Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ - BETA SMART FINANCE</p>
                                                <p className="mt-1">Ù‡Ø§ØªÙ: 19231 - info@betadevelopments.com</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ADMIN ONLY: Technical Details */}
                                {isAdmin && results && (
                                    <div className="mt-4 p-4 bg-white rounded-lg shadow print-hidden animate-fade-in">
                                        <h3 className="font-bold text-gray-800 mb-2">ğŸ” ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)</h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                            <div>
                                                <p className="text-gray-600">Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒØ§Ø´ (Target PV)</p>
                                                <p className="font-bold text-blue-700">{formatCurrency(results.verification.cashValue)}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">PV Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨</p>
                                                <p className="font-bold text-blue-700">{formatCurrency(results.verification.totalPV)}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ø§Ù„ÙØ±Ù‚ (PV Diff)</p>
                                                <p className="font-bold text-red-700">{formatCurrency(results.verification.difference)}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</p>
                                                <p className="font-bold text-red-700">{results.verification.percentDiff.toFixed(5)}%</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</p>
                                                <p className={`font-bold ${results.verification.status.includes('Ù…Ø·Ø§Ø¨Ù‚') ? 'text-green-600' : 'text-red-600'}`}>{results.verification.status}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹</p>
                                                <p className="font-bold text-green-700">{formatCurrency(results.summary.totalPaid)}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                                                <p className="font-bold text-orange-700">
                                                    {formatCurrency(results.summary.totalPaid - (unitValue * (100 - (getSelectedProject()?.cashDiscountRate || 0)) / 100))}
                                                </p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</p>
                                                <p className="font-bold text-orange-700">
                                                    {((results.summary.totalPaid / (unitValue * (100 - (getSelectedProject()?.cashDiscountRate || 0)) / 100) - 1) * 100).toFixed(2)}%
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Enhanced Comparison Modal */}
                        <ComparisonModal />

                        {/* Footer */}
                        <div className="text-center text-gray-600 text-sm mt-8 pb-8 print-hidden">
                            <p className="font-bold text-red-600 text-lg">Ø´Ø±ÙƒØ© Ø¨ÙŠØªØ§ Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</p>
                            <p className="mt-1">BETA SMART FINANCE | Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…Ø±Ù† - Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© - Ø®Ø¯Ù…Ø© Ù…ØªÙ…ÙŠØ²Ø©</p>
                            <p className="mt-2">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<BetaSmartFinance />, document.getElementById('root'));
    </script>
</body>
</html>
